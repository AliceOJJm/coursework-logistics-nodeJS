/**
 * Created by acer on 24.04.2015.
 */
var express = require('express');
var router = express.Router();
var passport = require('passport');
var expressValidator  = require('express-validator');
router.use(expressValidator());
router.get('/', function(req, res) {
    // render the page and pass in any flash data if it exists
    res.render('signup', { message: req.flash('signupMessage'),
                           errors: null });
});

router.post('/', function(req, res) {
    req.assert('title', 'Не заполнено поле "Название фирмы"').notEmpty();
    req.assert('email', 'Поле Email заполнено некорректно').isEmail();
    req.assert('password', 'Пароль должен содержать от 6 до 20 символов').len(6, 20);
    req.assert('proxy', 'Не заполнено поле "Доверенное лицо"').notEmpty();
    req.assert('line', 'Не заполнено поле "Род деятельности фирмы"').notEmpty();
    req.assert('registration_number', 'Не заполнено поле "Регистрационный номер"').notEmpty();
    req.assert('headquarters', 'Не заполнено поле "Адрес офиса"').notEmpty();
    req.assert('phone', 'Не заполнено поле "Контактный телефон"').notEmpty();

    var errors = req.validationErrors();
    if(!errors){   //No errors were found.  Passed Validation!
        console.log("|||||||||");
        passport.authenticate('local-signup', function(err, user, info) {
            console.log("22222");
            if (!user) { return res.redirect('/signup'); }
            req.logIn(user, function(err) {
                return res.redirect('/profile');
            });
        });

    }
    else {   //Display errors to user
        res.render('signup', {message: '',
                              errors: errors});
    }
});

module.exports = router;
<% if (errors) { %>
        <div class="alert alert-danger">
            <ul><% for(var errorCounter = 0; errorCounter < errors.length; errorCounter ++){%>
                <li><%= errors[errorCounter].msg %>
                    <% } %>
            </ul>
        </div>
        <% } %>